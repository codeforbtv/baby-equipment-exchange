rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
      // Administrator role
      match /Events/{document=**} {
        allow read: if request.auth != null && request.auth.token.admin == true;
      }
      match /Donations/{document=**} {
        allow read, write: if request.auth != null && request.auth.token.admin == true;
      }   
      match /BulkDonations/{document=**} {
        allow read, write: if request.auth != null && request.auth.token.admin == true;
      }
      // Aid worker role
       match /Donations/{document=**} {
        allow read: if request.auth != null && request.auth.token['aid-worker'] == true;
      }   
      match /Donations/{document=**} {
        allow update: if (request.resource.data.diff(resource.data).affectedKeys().hasOnly(['requestor', 'modifiedAt', 'dateDistributed']))
      }
      match /BulkDonations/{document=**} {
        allow read: if request.auth != null && request.auth.token['aid-worker'] == true;
      }
     
      // Standard user role
         match /Donations/{document=**} {
        allow create: if request.auth != null;
        } 
        match /Donations/{document=**} {
        allow read: if request.auth != null && request.auth.uid == resource.data.donorId;
        }  
        match /BulkDonations/{document=**} {
        allow create: if request.auth != null 
        }
        match /BulkDonations/{document=**} {
        allow read: if request.auth != null && request.auth.uid == resource.data.donorId;
        }        
  }
}